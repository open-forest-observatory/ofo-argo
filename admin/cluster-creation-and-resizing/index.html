
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://open-forest-observatory.github.io/ofo-argo/admin/cluster-creation-and-resizing/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../manila-share-mounting/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Cluster creation and resizing - OFO Argo Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cluster-creation-and-resizing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OFO Argo Documentation" class="md-header__button md-logo" aria-label="OFO Argo Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFO Argo Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cluster creation and resizing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OFO Argo Documentation" class="md-nav__button md-logo" aria-label="OFO Argo Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OFO Argo Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OFO Argo Workflows Documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../usage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    User guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/cluster-access-and-resizing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster access and resizing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/argo-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Argo on the OFO cluster
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Administrator guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Administrator guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Cluster creation and resizing
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Cluster creation and resizing
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#one-time-local-machine-software-setup" class="md-nav__link">
    <span class="md-ellipsis">
      One-time local machine software setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="One-time local machine software setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-python-and-create-virtual-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Install Python and create virtual environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-openstack-command-line-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Install OpenStack command line tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      Install kubectl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-application-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Create application credential
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-openstack-keypair" class="md-nav__link">
    <span class="md-ellipsis">
      Create OpenStack keypair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-shell-completion" class="md-nav__link">
    <span class="md-ellipsis">
      Enable shell completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Cluster creation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster creation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view-available-cluster-templates" class="md-nav__link">
    <span class="md-ellipsis">
      View available cluster templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-cluster-status-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Check cluster status (optional)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-kubectl-to-control-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Set up kubectl to control Kubernetes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-management" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view-cluster-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      View cluster nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-shell-on-cluster-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Access shell on cluster nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-disk-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Check disk usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-resizing" class="md-nav__link">
    <span class="md-ellipsis">
      Cluster resizing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster resizing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resize-the-default-worker-group" class="md-nav__link">
    <span class="md-ellipsis">
      Resize the default worker group
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-a-new-nodegroup" class="md-nav__link">
    <span class="md-ellipsis">
      Add a new nodegroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drain-nodes-before-downsizing-or-deleting" class="md-nav__link">
    <span class="md-ellipsis">
      Drain nodes before downsizing or deleting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resize-a-nodegroup" class="md-nav__link">
    <span class="md-ellipsis">
      Resize a nodegroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-a-nodegroup" class="md-nav__link">
    <span class="md-ellipsis">
      Delete a nodegroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Delete the cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring dashboards
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring dashboards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grafana-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana dashboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes dashboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manila-share-mounting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manila share mounting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../argo-installation-on-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Argo installation on cluster
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#one-time-local-machine-software-setup" class="md-nav__link">
    <span class="md-ellipsis">
      One-time local machine software setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="One-time local machine software setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-python-and-create-virtual-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Install Python and create virtual environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-openstack-command-line-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Install OpenStack command line tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      Install kubectl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-application-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Create application credential
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-openstack-keypair" class="md-nav__link">
    <span class="md-ellipsis">
      Create OpenStack keypair
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-shell-completion" class="md-nav__link">
    <span class="md-ellipsis">
      Enable shell completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Cluster creation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster creation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view-available-cluster-templates" class="md-nav__link">
    <span class="md-ellipsis">
      View available cluster templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-cluster-status-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Check cluster status (optional)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-kubectl-to-control-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Set up kubectl to control Kubernetes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-management" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view-cluster-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      View cluster nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-shell-on-cluster-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Access shell on cluster nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-disk-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Check disk usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-resizing" class="md-nav__link">
    <span class="md-ellipsis">
      Cluster resizing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster resizing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resize-the-default-worker-group" class="md-nav__link">
    <span class="md-ellipsis">
      Resize the default worker group
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-a-new-nodegroup" class="md-nav__link">
    <span class="md-ellipsis">
      Add a new nodegroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drain-nodes-before-downsizing-or-deleting" class="md-nav__link">
    <span class="md-ellipsis">
      Drain nodes before downsizing or deleting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resize-a-nodegroup" class="md-nav__link">
    <span class="md-ellipsis">
      Resize a nodegroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-a-nodegroup" class="md-nav__link">
    <span class="md-ellipsis">
      Delete a nodegroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Delete the cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring dashboards
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring dashboards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grafana-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana dashboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes dashboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cluster-creation-and-resizing">Cluster creation and resizing</h1>
<p>This guide is for the cluster administrator (currently Derek). Since we only need one cluster and
Derek is taking care of creating it, this guide is not necessary for the whole team. There is a
separate guide on cluster management that is for the whole team.</p>
<p><strong>Key resource</strong> referenced in creating this guide: <a href="https://gitlab.com/jetstream-cloud/jetstream2/eot/tutorials/magnum-tutorial/-/wikis/beginners_guide_to_magnum_on_JS2">Beginner's Guide to Magnum on
Jetstream2</a></p>
<h2 id="one-time-local-machine-software-setup">One-time local machine software setup</h2>
<p>These instructions will set up your local (Linux, Mac, or WSL) machine to control the cluster through the command line.</p>
<h3 id="install-python-and-create-virtual-environment">Install Python and create virtual environment</h3>
<p>Make sure you have a recent Python interpreter and the venv utility, then create a virtual environment for OpenStack management:</p>
<pre><code class="language-bash">sudo apt update
sudo apt install -y python3-full python3-venv
python3 -m venv ~/venv/openstack
</code></pre>
<h3 id="install-openstack-command-line-tools">Install OpenStack command line tools</h3>
<pre><code class="language-bash"># Activate environment
source ~/venv/openstack/bin/activate

# Install OpenStack utilities
pip install -U python-openstackclient python-magnumclient python-designateclient
</code></pre>
<h3 id="install-kubectl">Install kubectl</h3>
<p>Install the Kubernetes control utility <code>kubectl</code> (from the <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">official Kubernetes documentation</a>):</p>
<pre><code class="language-bash"># Install prerequisites
sudo apt install -y apt-transport-https ca-certificates curl gnupg

# Add Kubernetes apt repository
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.33/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
sudo chmod 644 /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.33/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo chmod 644 /etc/apt/sources.list.d/kubernetes.list

# Install kubectl
sudo apt update
sudo apt install -y kubectl
</code></pre>
<h3 id="create-application-credential">Create application credential</h3>
<p>In <a href="https://js2.jetstream-cloud.org">Horizon</a>, go to <strong>Identity &gt; Application Credentials</strong>. Click <strong>Create</strong>:</p>
<ul>
<li>Do not change the roles</li>
<li>Do not set a secret (one will be generated)</li>
<li><strong>Do</strong> set an expiration date</li>
<li><strong>Do</strong> check "unrestricted" (required because Magnum creates additional app credentials for the cluster)</li>
</ul>
<p>Download the openrc file and store it in the OFO <a href="http://vault.focal-lab.org">Vaultwarden</a> organization where OFO members can access it.</p>
<p>Copy the application credential onto your <strong>local computer</strong> (do not put it on a JS2 machine),
ideally into <code>~/.ofocluster/app-cred-ofocluster-openrc.sh</code> (which is where we will assume it is in
these docs).</p>
<p>Source the application credential (which sets relevant environment variables for the OpenStack command line tools):</p>
<pre><code class="language-bash">source ~/.ofocluster/app-cred-ofocluster-openrc.sh
</code></pre>
<h3 id="create-openstack-keypair">Create OpenStack keypair</h3>
<p>Create a keypair for cluster node access. If you want, you can save the private key that is displayed when you run this command in order to SSH into the cluster nodes later. However, they won't have public IP addresses, so this is mainly to satisfy Magnum's requirements.</p>
<pre><code class="language-bash"># Create a new keypair (displays private key - save if needed)
openstack keypair create my-openstack-keypair-name
</code></pre>
<p><strong>Alternatively</strong>, specify an existing public key you normally use, in this example <code>~/.ssh/id_rsa.pub</code>:</p>
<pre><code class="language-bash"># Use existing public key
openstack keypair create my-openstack-keypair-name --public-key ~/.ssh/id_rsa.pub
</code></pre>
<h3 id="enable-shell-completion">Enable shell completion</h3>
<pre><code class="language-bash"># Create directory for completion scripts
mkdir -p ~/.bash_completion.d

# Generate completion scripts
openstack complete &gt; ~/.ofocluster/openstack-completion.bash
kubectl completion bash &gt; ~/.ofocluster/kubectl-completion.bash

# Add to ~/.bashrc
echo 'source ~/.ofocluster/openstack-completion.bash' &gt;&gt; ~/.bashrc
echo 'source ~/.ofocluster/kubectl-completion.bash' &gt;&gt; ~/.bashrc
</code></pre>
<h2 id="cluster-creation">Cluster creation</h2>
<p>Assuming you're in a fresh shell session, enter your JS2 venv and source the application credential:</p>
<pre><code class="language-bash">source ~/venv/openstack/bin/activate
source ~/.ofocluster/app-cred-ofocluster-openrc.sh
</code></pre>
<h3 id="view-available-cluster-templates">View available cluster templates</h3>
<pre><code class="language-bash">openstack coe cluster template list
</code></pre>
<h3 id="deploy-the-cluster">Deploy the cluster</h3>
<p>Specify the deployment parameters and create the cluster. Choose the most recent Kubernetes version
(highest number in the template list). The master node can be <code>m3.small</code>. We'll deploy a cluster
with a single worker node that is also <code>m3.small</code>. When we need to scale up, we'll add nodegroups.
This initial spec is just the base setup for when we're not running Argo workloads on it.</p>
<pre><code class="language-bash"># Set deployment parameters
TEMPLATE=&quot;kubernetes-1-33-jammy&quot;
FLAVOR=&quot;m3.small&quot;
MASTER_FLAVOR=&quot;m3.small&quot;
BOOT_VOLUME_SIZE_GB=80

# Number of instances
N_MASTER=1  # Needs to be odd
N_WORKER=1

# Min and max number of worker nodes (if using autoscaling)
AUTOSCALE=false
N_WORKER_MIN=1
N_WORKER_MAX=5

# Network configuration
NETWORK_ID=$(openstack network show --format value -c id auto_allocated_network)
SUBNET_ID=$(openstack subnet show --format value -c id auto_allocated_subnet_v4)
KEYPAIR=my-openstack-keypair-name

# Deploy the cluster
openstack coe cluster create \
    --cluster-template $TEMPLATE \
    --master-count $N_MASTER --node-count $N_WORKER \
    --master-flavor $MASTER_FLAVOR --flavor $FLAVOR \
    --merge-labels \
    --labels auto_scaling_enabled=$AUTOSCALE \
    --labels min_node_count=$N_WORKER_MIN \
    --labels max_node_count=$N_WORKER_MAX \
    --labels boot_volume_size=$BOOT_VOLUME_SIZE_GB \
    --keypair $KEYPAIR \
    --fixed-network &quot;${NETWORK_ID}&quot; \
    --fixed-subnet &quot;${SUBNET_ID}&quot; \
    &quot;ofocluster&quot;
</code></pre>
<h3 id="check-cluster-status-optional">Check cluster status (optional)</h3>
<pre><code class="language-bash">openstack coe cluster list
openstack coe cluster show ofocluster
openstack coe nodegroup list ofocluster
</code></pre>
<p>Or with formatting that makes it easier to copy the cluster UUID:</p>
<pre><code class="language-bash">openstack coe cluster list --format value -c uuid -c name
</code></pre>
<h2 id="set-up-kubectl-to-control-kubernetes">Set up <code>kubectl</code> to control Kubernetes</h2>
<p>This is required the first time you interact with Kubernetes on the cluster. <code>kubectl</code> is a tool to
control Kubernetes (the cluster's software, not its compute nodes/VMs) from your local command line.</p>
<p>Once the <code>openstack coe cluster list</code> status (command above) changes to <code>CREATE_COMPLETE</code>, get the Kubernetes configuration file (<code>kubeconfig</code>) and configure your environment:</p>
<pre><code class="language-bash"># Get cluster configuration
openstack coe cluster config &quot;ofocluster&quot; --force

# Set permissions and move to appropriate location
chmod 600 config
mkdir -p ~/.ofocluster
mv -i config ~/.ofocluster/ofocluster.kubeconfig

# Set KUBECONFIG environment variable
export KUBECONFIG=~/.ofocluster/ofocluster.kubeconfig
</code></pre>
<h2 id="kubernetes-management">Kubernetes management</h2>
<p>If you are resuming cluster management after a reboot, you will need to re-set environment variables and source the application credential:</p>
<pre><code class="language-bash">source ~/venv/openstack/bin/activate
export KUBECONFIG=~/.ofocluster/ofocluster.kubeconfig
source ~/.ofocluster/app-cred-ofocluster-openrc.sh
</code></pre>
<h3 id="view-cluster-nodes">View cluster nodes</h3>
<pre><code class="language-bash">kubectl get nodes
</code></pre>
<h3 id="access-shell-on-cluster-nodes">Access shell on cluster nodes</h3>
<p>Run commands on a node with:</p>
<pre><code class="language-bash"># Start a debug session on a specific node
kubectl debug node/&lt;node-name&gt; -it --image=ubuntu

# Once inside, you have host access via /host
# Check kernel modules
chroot /host modprobe ceph
chroot /host lsmod | grep ceph
</code></pre>
<h3 id="check-disk-usage">Check disk usage</h3>
<p>Run a one-off command to check disk usage:</p>
<pre><code class="language-bash">kubectl debug node/&lt;node-name&gt; -it --image=busybox -- df -h
</code></pre>
<p>Look for the <code>/dev/vda1</code> volume. Then delete the debugging pods:</p>
<pre><code class="language-bash">kubectl get pods -o name | grep node-debugger | xargs kubectl delete
</code></pre>
<h2 id="cluster-resizing">Cluster resizing</h2>
<p>These instructions are for managing which nodes are in the cluster, not what software is running on them.</p>
<h3 id="resize-the-default-worker-group">Resize the default worker group</h3>
<p>Resize the cluster by adding or removing nodes from the original worker group (not a later-added nodegroup). We will likely not do this, relying instead on nodegroups for specific runs.</p>
<pre><code class="language-bash">openstack coe cluster resize &quot;ofocluster&quot; 4
</code></pre>
<h3 id="add-a-new-nodegroup">Add a new nodegroup</h3>
<p>To add a new nodegroup, first specify its parameters and then use OpenStack to create it:</p>
<pre><code class="language-bash"># Set nodegroup parameters
NODEGROUP_NAME=cpu-group  # or gpu-group
FLAVOR=m3.quad  # or &quot;g3.medium&quot; for GPU
N_WORKER=1
AUTOSCALE=false
N_WORKER_MIN=1
N_WORKER_MAX=5
BOOT_VOLUME_SIZE_GB=80

# Create the nodegroup
openstack coe nodegroup create ofocluster $NODEGROUP_NAME \
    --flavor $FLAVOR \
    --node-count $N_WORKER \
    --labels auto_scaling_enabled=$AUTOSCALE \
    --labels min_node_count=$N_WORKER_MIN \
    --labels max_node_count=$N_WORKER_MAX \
    --labels boot_volume_size=$BOOT_VOLUME_SIZE_GB
</code></pre>
<h3 id="drain-nodes-before-downsizing-or-deleting">Drain nodes before downsizing or deleting</h3>
<p>When decreasing the number of nodes in a nodegroup, it's best practice to drain the Kubernetes pods from them first. Since we don't know which nodes OpenStack will delete when reducing the size, we have to drain the whole nodegroup. This is also what you'd do when deleting a nodegroup entirely.</p>
<pre><code class="language-bash">NODEGROUP_NAME=cpu-group
kubectl get nodes -l capi.stackhpc.com/node-group=$NODEGROUP_NAME -o name | xargs -I {} kubectl drain {} --ignore-daemonsets --delete-emptydir-data
</code></pre>
<h3 id="resize-a-nodegroup">Resize a nodegroup</h3>
<p>Change the number of nodes in an existing nodegroup:</p>
<pre><code class="language-bash">N_WORKER=2
NODEGROUP_NAME=cpu-group
openstack coe cluster resize ofocluster --nodegroup $NODEGROUP_NAME $N_WORKER
</code></pre>
<h3 id="delete-a-nodegroup">Delete a nodegroup</h3>
<pre><code class="language-bash">openstack coe nodegroup delete ofocluster $NODEGROUP_NAME
</code></pre>
<h3 id="delete-the-cluster">Delete the cluster</h3>
<pre><code class="language-bash">openstack coe cluster delete &quot;ofocluster&quot;
</code></pre>
<h2 id="monitoring-dashboards">Monitoring dashboards</h2>
<p>Incomplete notes in development.</p>
<h3 id="grafana-dashboard">Grafana dashboard</h3>
<pre><code class="language-bash"># Port-forward Grafana to your local machine
kubectl port-forward -n monitoring-system svc/kube-prometheus-stack-grafana 3000:80
</code></pre>
<p>Then open http://localhost:3000 in your browser.</p>
<h3 id="kubernetes-dashboard">Kubernetes dashboard</h3>
<pre><code class="language-bash"># Create service account
kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard

# Create cluster role binding
kubectl create clusterrolebinding dashboard-admin \
    --clusterrole=cluster-admin \
    --serviceaccount=kubernetes-dashboard:dashboard-admin

# Create token (24 hour duration)
kubectl create token dashboard-admin -n kubernetes-dashboard --duration=24h

# Port-forward (if not already running)
kubectl port-forward -n kubernetes-dashboard svc/kubernetes-dashboard 8443:443
</code></pre>
<p>Then open https://localhost:8443 in your browser and use the token to log in.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Administrator guides">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Administrator guides
              </div>
            </div>
          </a>
        
        
          
          <a href="../manila-share-mounting/" class="md-footer__link md-footer__link--next" aria-label="Next: Manila share mounting">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Manila share mounting
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>