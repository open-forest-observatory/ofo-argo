
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://open-forest-observatory.github.io/ofo-argo/usage/photogrammetry-workflow/">
      
      
        <link rel="prev" href="../argo-usage/">
      
      
        <link rel="next" href="../stepbased-workflow/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Running the photogrammetry workflow - OFO Argo Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-the-photogrammetry-workflow-original-monolithic-version" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OFO Argo Documentation" class="md-header__button md-logo" aria-label="OFO Argo Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFO Argo Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Running the photogrammetry workflow
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OFO Argo Documentation" class="md-nav__button md-logo" aria-label="OFO Argo Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OFO Argo Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OFO Argo Workflows Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    User guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-access-and-resizing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster access and resizing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../argo-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Argo on the OFO cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Running the photogrammetry workflow
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Running the photogrammetry workflow
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-prepare-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Prepare inputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Prepare inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Directory structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-drone-imagery-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add drone imagery datasets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specify-metashape-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specify Metashape parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-config-list-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a config list file
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Submit the workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Submit the workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitor-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitor the workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitor the workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-argo-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the Argo UI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Argo UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#navigating-the-argo-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigating the Argo UI
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow outputs
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stepbased-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running the step-based photogrammetry workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stepbased-quick-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Step-based workflow quick reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../admin/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Administrator guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Administrator guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/cluster-creation-and-resizing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster creation and resizing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/manila-share-mounting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manila share mounting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/argo-installation-on-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Argo installation on cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-prepare-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Prepare inputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Prepare inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Directory structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-drone-imagery-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add drone imagery datasets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specify-metashape-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specify Metashape parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-config-list-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a config list file
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Submit the workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Submit the workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitor-the-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitor the workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitor the workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-argo-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using the Argo UI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the Argo UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#navigating-the-argo-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigating the Argo UI
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow outputs
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="running-the-photogrammetry-workflow-original-monolithic-version">Running the photogrammetry workflow (original monolithic version)</h1>
<div class="admonition warning">
<p class="admonition-title">Step-Based Workflow Recommended</p>
<p>A new <strong><a href="../stepbased-workflow/">step-based workflow</a></strong> with optimized resource allocation is now available and <strong>recommended for all new processing</strong>.</p>
<p><strong>Benefits of step-based workflow:</strong></p>
<ul>
<li>ðŸ’° 60-80% reduction in GPU costs</li>
<li>ðŸ“Š Individual step monitoring and debugging</li>
<li>ðŸ”§ Configurable GPU vs CPU scheduling</li>
<li>âš¡ Disabled steps are completely skipped (no resource allocation)</li>
</ul>
<p><strong>This page documents the original monolithic workflow for reference only.</strong></p>
</div>
<p>This guide describes how to run the original OFO photogrammetry workflow, which processes drone imagery using <a href="https://github.com/open-forest-observatory/automate-metashape">automate-metashape</a> in a single monolithic container and performs post-processing steps.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before running the workflow, ensure you have:</p>
<ol>
<li><a href="../cluster-access-and-resizing/">Installed and set up the <code>openstack</code> and <code>kubectl</code> utilities</a></li>
<li><a href="../argo-usage/">Installed the Argo CLI</a></li>
<li>Added the appropriate type and number of nodes to the cluster (cluster-access-and-resizing.md#cluster-resizing)</li>
<li>Set up your <code>kubectl</code> authentication env var (part of instructions for adding nodes). Quick reference:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>source ~/venv/openstack/bin/activate
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>source ~/.ofocluster/app-cred-ofocluster-openrc.sh
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>export KUBECONFIG=~/.ofocluster/ofocluster.kubeconfig
</code></pre></div>
<h2 id="workflow-overview">Workflow overview</h2>
<p>The workflow performs the following steps:</p>
<ol>
<li>Pulls raw drone imagery from <code>/ofo-share-2</code> onto the Kubernetes VM cluster</li>
<li>Processes the imagery with Metashape</li>
<li>Writes the imagery products to <code>/ofo-share-2</code></li>
<li>Uploads the imagery products to <code>S3:ofo-internal</code> and deletes them from <code>/ofo-share</code></li>
<li>Downloads the imagery products from S3 back to the cluster and performs <a href="https://github.com/open-forest-observatory/ofo-argo/tree/main/postprocess_docker">postprocessing</a> (CHMs, clipping, COGs, thumbnails)</li>
<li>Uploads the final products to <code>S3:ofo-public</code></li>
</ol>
<h2 id="setup">Setup</h2>
<h3 id="1-prepare-inputs">1. Prepare inputs</h3>
<p>Before running the workflow, you need to prepare three types of inputs on the cluster's shared storage:</p>
<ol>
<li>Drone imagery datasets (JPEG images)</li>
<li>Metashape configuration files</li>
<li>A config list file specifying which configs to process</li>
</ol>
<p>All inputs must be placed in <code>/ofo-share-2/argo-data/</code>.</p>
<h4 id="directory-structure">Directory structure</h4>
<p>Here is a schematic of the <code>/ofo-share-2/argo-data</code> directory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>/ofo-share-2/argo-data/
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>â”œâ”€â”€<span class="w"> </span>argo-input/
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">   </span>â”œâ”€â”€<span class="w"> </span>datasets/
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">   </span>â”‚<span class="w">   </span>â”œâ”€â”€dataset_1/
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”œâ”€â”€<span class="w"> </span>image_01.jpg
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>image_02.jpg
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">   </span>â”‚<span class="w">   </span>â””â”€â”€dataset_2/
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">   </span>â”‚<span class="w">       </span>â”œâ”€â”€<span class="w"> </span>image_01.jpg
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">   </span>â”‚<span class="w">       </span>â””â”€â”€<span class="w"> </span>image_02.jpg
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">   </span>â”œâ”€â”€<span class="w"> </span>configs/
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">   </span>â”‚<span class="w">   </span>â”œâ”€â”€config_dataset_1.yml
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">   </span>â”‚<span class="w">   </span>â””â”€â”€config_dataset_2.yml
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">   </span>â””â”€â”€<span class="w"> </span>config_list.txt
</code></pre></div>
<h4 id="add-drone-imagery-datasets">Add drone imagery datasets</h4>
<p>To add new drone imagery datasets to be processed using Argo, transfer files from your local machine (or the cloud) to the <code>/ofo-share-2</code> volume. Put the drone imagery projects to be processed in their own directory in <code>/ofo-share-2/argo-data/argo-input/datasets</code>.</p>
<p>One data transfer method is the <code>scp</code> command-line tool:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>scp<span class="w"> </span>-r<span class="w"> </span>&lt;local/directory/drone_image_dataset/&gt;<span class="w"> </span>exouser@&lt;vm.ip.address&gt;:/ofo-share-2/argo-data/argo-input/datasets
</code></pre></div>
<p>Replace <code>&lt;vm.ip.address&gt;</code> with the IP address of a cluster node that has the share mounted.</p>
<h4 id="specify-metashape-parameters">Specify Metashape parameters</h4>
<p>Metashape processing parameters are specified in <a href="https://github.com/open-forest-observatory/automate-metashape/blob/main/config/config-base.yml">configuration YAML files</a> which need to be located at <code>/ofo-share-2/argo-data/argo-input/configs/</code>.</p>
<p>Every dataset to be processed needs to have its own standalone configuration file.</p>
<p><strong>Naming convention:</strong> Config files should be named to match the naming convention <code>&lt;config_id&gt;_&lt;datasetname&gt;.yml</code>. For example:</p>
<ul>
<li><code>01_benchmarking-greasewood.yml</code></li>
<li><code>02_benchmarking-greasewood.yml</code></li>
</ul>
<p><strong>Setting the <code>photo_path</code>:</strong> Within each metashape config.yml file, you must specify <code>photo_path</code>
which is the location of the drone imagery dataset to be processed. When running via Argo workflows,
this path refers to the location of the images <strong>inside the docker container</strong>.</p>
<p>For example, if your drone images were uploaded to <code>/ofo-share-2/argo-data/argo-input/datasets/dataset_1</code>, then the <code>photo_path</code> should be written as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">photo_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/argo-input/datasets/dataset_1</span>
</code></pre></div>
<p><strong>Parameters handled by Argo:</strong> The <code>output_path</code>, <code>project_path</code>, and <code>run_name</code> configuration parameters are handled automatically by the Argo workflow:</p>
<ul>
<li><code>output_path</code> and <code>project_path</code> are determined via the arguments passed to the automate-metashape container, which in turn are derived from the <code>RUN_FOLDER</code> workflow parameter passed when invoking <code>argo submit</code></li>
<li><code>run_name</code> is pulled from the name of the config file (minus the extension) by the Argo workflow</li>
</ul>
<p>Any values specified for these parameters in the config.yml will be ignored.</p>
<h4 id="create-a-config-list-file">Create a config list file</h4>
<p>We use a text file, for example <code>config_list.txt</code>, to tell the Argo workflow which config files should be processed in the current run. This text file should list the paths to each config.yml file you want to process (relative to <code>/ofo-share-2/argo-data</code>), one config file path per line.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>argo-input/configs/01_benchmarking-greasewood.yml
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>argo-input/configs/02_benchmarking-greasewood.yml
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>argo-input/configs/01_benchmarking-emerald-subset.yml
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>argo-input/configs/02_benchmarking-emerald-subset.yml
</code></pre></div>
<p>This allows you to organize your config files in subdirectories or different locations. The dataset name will be automatically derived from the config filename (e.g., <code>argo-input/configs/dataset-name.yml</code> becomes dataset <code>dataset-name</code>).</p>
<p>You can create your own config list file and name it whatever you want, placing it anywhere within <code>/ofo-share-2/argo-data/</code>. Then specify the path to it (relative to <code>/ofo-share-2/argo-data</code>) using the <code>CONFIG_LIST</code> parameter when submitting the workflow.</p>
<h2 id="submit-the-workflow">Submit the workflow</h2>
<p>Once your cluster authentication is set up and your inputs are prepared, run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>argo<span class="w"> </span>submit<span class="w"> </span>-n<span class="w"> </span>argo<span class="w"> </span>photogrammetry-workflow.yaml<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>-p<span class="w"> </span><span class="nv">CONFIG_LIST</span><span class="o">=</span>argo-input/config-lists/config_list.txt<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>-p<span class="w"> </span><span class="nv">RUN_FOLDER</span><span class="o">=</span>gillan_june27<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>-p<span class="w"> </span><span class="nv">PHOTOGRAMMETRY_CONFIG_ID</span><span class="o">=</span><span class="m">01</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>-p<span class="w"> </span><span class="nv">S3_BUCKET_INTERNAL</span><span class="o">=</span>ofo-internal<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>-p<span class="w"> </span><span class="nv">S3_BUCKET_PUBLIC</span><span class="o">=</span>ofo-public<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>-p<span class="w"> </span><span class="nv">OUTPUT_DIRECTORY</span><span class="o">=</span>jgillan_test<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>-p<span class="w"> </span><span class="nv">S3_BOUNDARY_DIR</span><span class="o">=</span>jgillan_test<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>-p<span class="w"> </span><span class="nv">WORKING_DIR</span><span class="o">=</span>/argo-output/temp-working-dir<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>-p<span class="w"> </span><span class="nv">OFO_ARGO_IMAGES_TAG</span><span class="o">=</span>latest
</code></pre></div>
<p>Database parameters (not currently functional):
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>-p<span class="w"> </span><span class="nv">DB_PASSWORD</span><span class="o">=</span>&lt;password&gt;<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>-p<span class="w"> </span><span class="nv">DB_HOST</span><span class="o">=</span>&lt;vm_ip_address&gt;<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>-p<span class="w"> </span><span class="nv">DB_NAME</span><span class="o">=</span>&lt;db_name&gt;<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>-p<span class="w"> </span><span class="nv">DB_USER</span><span class="o">=</span>&lt;user_name&gt;
</code></pre></div></p>
<h3 id="workflow-parameters">Workflow parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CONFIG_LIST</code></td>
<td>Path to text file listing paths to metashape config files (all paths relative to <code>/ofo-share-2/argo-data</code>)</td>
</tr>
<tr>
<td><code>RUN_FOLDER</code></td>
<td>Name for the parent directory of the Metashape outputs (locally under <code>argo-data/argo-outputs</code> <strong>and</strong> at the top level of the S3 bucket). Example: <code>photogrammetry-outputs</code>.</td>
</tr>
<tr>
<td><code>PHOTOGRAMMETRY_CONFIG_ID</code></td>
<td>Two-digit configuration ID (e.g., <code>01</code>, <code>02</code>) used to organize outputs into <code>photogrammetry_NN</code> subdirectories in S3 for both raw and postprocessed products. If not specified, both raw and postprocessed products are stored directly in <code>RUN_FOLDER</code> (no <code>photogrammetry_NN</code> subfolder).</td>
</tr>
<tr>
<td><code>S3_BUCKET_INTERNAL</code></td>
<td>S3 bucket for internal/intermediate outputs where raw Metashape products (orthomosaics, point clouds, DEMs) are uploaded (typically <code>ofo-internal</code>). When <code>PHOTOGRAMMETRY_CONFIG_ID</code> is set, products are uploaded to <code>{bucket}/{RUN_FOLDER}/photogrammetry_{PHOTOGRAMMETRY_CONFIG_ID}/</code>. When not set, products go to <code>{bucket}/{RUN_FOLDER}/</code>.</td>
</tr>
<tr>
<td><code>S3_BUCKET_PUBLIC</code></td>
<td>S3 bucket for public/final outputs (postprocessed, clipped products ready for distribution) and where boundary files are stored (typically <code>ofo-public</code>).</td>
</tr>
<tr>
<td><code>OUTPUT_DIRECTORY</code></td>
<td>Name of parent folder where postprocessed products are uploaded. When <code>PHOTOGRAMMETRY_CONFIG_ID</code> is set, products are organized as <code>{OUTPUT_DIRECTORY}/{mission_name}/photogrammetry_{PHOTOGRAMMETRY_CONFIG_ID}/</code>. When not set, products go to <code>{OUTPUT_DIRECTORY}/{mission_name}/</code>.</td>
</tr>
<tr>
<td><code>S3_BOUNDARY_DIR</code></td>
<td>Parent directory in <code>S3_BUCKET_PUBLIC</code> where mission boundary polygons reside (used to clip imagery). Expected structure: <code>&lt;S3_BOUNDARY_DIR&gt;/&lt;mission_name&gt;/metadata-mission/&lt;mission_name&gt;_mission-metadata.gpkg</code>.</td>
</tr>
<tr>
<td><code>WORKING_DIR</code></td>
<td>Directory within container for downloading and postprocessing (typically <code>/tmp/processing</code> which downloads data to the processing computer; can be changed to a persistent volume)</td>
</tr>
<tr>
<td><code>OFO_ARGO_IMAGES_TAG</code></td>
<td>Docker image tag for OFO Argo containers (postprocessing) (default: <code>latest</code>). Use a specific branch name or tag to test development versions (e.g., <code>dy-manila</code>)</td>
</tr>
<tr>
<td><code>DB_*</code></td>
<td>Database parameters for logging Argo status (not currently functional; credentials in <a href="https://docs.google.com/document/d/155AP0P3jkVa-yT53a-QLp7vBAfjRa78gdST1Dfb4fls/edit?tab=t.0">OFO credentials document</a>)</td>
</tr>
</tbody>
</table>
<p><strong>Secrets configuration:</strong>
- <strong>S3 credentials</strong>: S3 access credentials, provider type, and endpoint URL are configured via the <code>s3-credentials</code> Kubernetes secret
- <strong>Agisoft license</strong>: Metashape floating license server address is configured via the
  <code>agisoft-license</code> Kubernetes secret</p>
<p>These secrets should have been created (within the <code>argo</code> namespace) during <a href="../../admin/cluster-creation-and-resizing/">cluster creation</a>.</p>
<h2 id="monitor-the-workflow">Monitor the workflow</h2>
<h3 id="using-the-argo-ui">Using the Argo UI</h3>
<p>The Argo UI is great for troubleshooting and checking additional logs. Access it at <a href="https://argo.focal-lab.org">argo.focal-lab.org</a>, using the credentials from <a href="https://vault.focal-lab.org">Vaultwarden</a> under the record "Argo UI token".</p>
<h4 id="navigating-the-argo-ui">Navigating the Argo UI</h4>
<p>The <strong>Workflows</strong> tab on the left side menu shows all running workflows. Click a current workflow to see a schematic of the jobs spread across multiple instances:</p>
<p><img alt="Argo workflow overview" src="https://github.com/user-attachments/assets/bd6bd991-f108-4be9-a1aa-6cb0f1ab1db5" /></p>
<p>Click on a specific job to see detailed information including which VM it is running on, the duration of the process, and logs:</p>
<p><img alt="Argo job details" src="https://github.com/user-attachments/assets/ab10f2b4-3120-47be-b1dd-601687707f0c" /></p>
<p>A successful Argo run looks like this:</p>
<p><img alt="Successful Argo run" src="https://github.com/user-attachments/assets/201b0594-7557-4d85-a99b-677e6c173a44" /></p>
<h2 id="workflow-outputs">Workflow outputs</h2>
<p>The final outputs will be written to <code>S3:ofo-public</code> in the following directory structure:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>/S3:ofo-public/
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>â”œâ”€â”€<span class="w"> </span>&lt;OUTPUT_DIRECTORY&gt;/
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span>â”œâ”€â”€<span class="w"> </span>dataset1/
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">         </span>â”œâ”€â”€<span class="w"> </span>images/
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">         </span>â”œâ”€â”€<span class="w"> </span>metadata-images/
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">         </span>â”œâ”€â”€<span class="w"> </span>metadata-mission/
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">            </span>â””â”€â”€<span class="w"> </span>dataset1_mission-metadata.gpkg
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">         </span>â”œâ”€â”€photogrammetry_01/
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">            </span>â”œâ”€â”€<span class="w"> </span>full/
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_cameras.xml
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_chm-ptcloud.tif
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dsm-ptcloud.tif
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dtm-ptcloud.tif
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_log.txt
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_ortho-dtm-ptcloud.tif
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_points.copc.laz
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">               </span>â””â”€â”€<span class="w"> </span>dataset1_report.pdf
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">            </span>â”œâ”€â”€<span class="w"> </span>thumbnails/
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_chm-ptcloud.png
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dsm-ptcloud.png
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dtm-ptcloud.png
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="w">               </span>â””â”€â”€<span class="w"> </span>dataset1-ortho-dtm-ptcloud.png
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="w">         </span>â”œâ”€â”€photogrammetry_02/
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="w">            </span>â”œâ”€â”€<span class="w"> </span>full/
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_cameras.xml
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_chm-ptcloud.tif
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dsm-ptcloud.tif
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dtm-ptcloud.tif
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_log.txt
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_ortho-dtm-ptcloud.tif
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_points.copc.laz
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="w">               </span>â””â”€â”€<span class="w"> </span>dataset1_report.pdf
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="w">            </span>â”œâ”€â”€<span class="w"> </span>thumbnails/
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_chm-ptcloud.png
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dsm-ptcloud.png
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="w">               </span>â”œâ”€â”€<span class="w"> </span>dataset1_dtm-ptcloud.png
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="w">               </span>â””â”€â”€<span class="w"> </span>dataset1-ortho-dtm-ptcloud.png
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="w">    </span>â”œâ”€â”€<span class="w"> </span>dataset2/
</code></pre></div>
<p>This directory structure should already exist prior to running the Argo workflow.</p>
<!--

## Argo Workflow Logging in PostGIS Database

**THE DB LOGGING IS CURRENTLY DISABLED AND IS BEING MIGRATED TO A HOSTED SOLUTION THROUGH SUPABASE**

Argo run status is logged into a PostGIS DB. This is done through an additional docker container (hosted on GitHub Container Registry `ghcr.io/open-forest-observatory/argo-workflow-utils:latest`) that is included in the argo workflow. The files to make the docker image are in the folder `argo-workflow-utils`.

### Info on the PostGIS DB

There is a JS2 VM called `ofo-postgis` that hosts a PostGIS DB for storing metadata of argo workflows.

You can access the `ofo-postgis` VM through Webshell in Exosphere. Another access option is to SSH into `ofo-postgis` with the command `ssh exouser@<ip_address>`. This is not public and will require a password.

The DB is running in a docker container (`postgis/postgis`). The DB storage is a 10 GB volume at `/media/volume/ofo-postgis` on the VM.

### Steps to View the Logged Results

Enter the Docker container running the PostGIS server:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>ofo-postgis<span class="w"> </span>bash
</code></pre></div>

Launch the PostgreSQL CLI as the intended user (grab from DB credentials):
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>psql<span class="w"> </span>-U<span class="w"> </span>postgres
</code></pre></div>

List all tables in the database:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>\dt
</code></pre></div>

Show the structure of a specific table (column names & data types):
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>\d automate_metashape
</code></pre></div>

Currently, the PostGIS server stores the following keys in the `automate_metashape` table:

| **Column**   | **Type** | **Description**  |
|  --- | ----  | --- |
|id | integer | unique identifier for each call of automate-metashape (not run) |
|dataset_name | character varying(100) | dataset running for the individual call of automate-metashape |
| workflow_id | character varying(100) | identifier for run of ofo-argo |
| status | character varying(50)  | either queued, processing, failed or completed, based on current and final status of automate-metashape |
| start_time | timestamp without time zone | start time of automate-metashape run |
| finish_time  | timestamp without time zone | end time of automate-metashape run (if it was able to finish) |
| created_at | timestamp without time zone | creation time of entry in database |

View all data records for a specific table:
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">automate_metashape</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>

![SQL query results](https://github.com/user-attachments/assets/cba4532a-21de-4c35-8b2d-635eec326ef7)

Exit out of psql command-line:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>\q
</code></pre></div>

Exit out of container:
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">exit</span>
</code></pre></div>

### Other useful commands

View all running and stopped containers:
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</code></pre></div>

Stop a running container:
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>docker<span class="w"> </span>stop<span class="w"> </span>&lt;container_id&gt;
</code></pre></div>

Remove container:
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>docker<span class="w"> </span>rm<span class="w"> </span>&lt;container_id&gt;
</code></pre></div>

Run the docker container DB:
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>ofo-postgis<span class="w">   </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>ujJ1tsY9OizN0IpOgl1mY1cQGvgja3SI<span class="w">   </span>-p<span class="w"> </span><span class="m">5432</span>:5432<span class="w">   </span>-v<span class="w"> </span>/media/volume/ofo-postgis/data:/var/lib/postgresql/data<span class="w">  </span>-d<span class="w"> </span>postgis/postgis
</code></pre></div>

### Github action to rebuild DB logging docker image

There is a GitHub action workflow that rebuilds the logging docker image if any changes have been made at all in the repo. This workflow is in the directory `.github/workflows`. **The workflow is currently disabled in the 'Actions' section of the repository.**

-->







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../argo-usage/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Using Argo on the OFO cluster">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Using Argo on the OFO cluster
              </div>
            </div>
          </a>
        
        
          
          <a href="../stepbased-workflow/" class="md-footer__link md-footer__link--next" aria-label="Next: Running the step-based photogrammetry workflow">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Running the step-based photogrammetry workflow
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.footer", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>